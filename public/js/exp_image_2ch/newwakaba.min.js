function get_cookie(name){with(document.cookie){var regexp=new RegExp("(^|;\\s+)"+name+"=(.*?)(;|$)"),hit=regexp.exec(document.cookie);return hit&&hit.length>2?unescape(hit[2]):""}}function set_cookie(e,t,a){if(a){var n=new Date;n.setTime(n.getTime()+24*a*60*60*1e3);var o="; expires="+n.toGMTString()}else o="";document.cookie=e+"="+t+o+"; path=/"}function $id(e){return document.getElementById(e)}function $n(e){return document.getElementsByName(e)[0]}function $t(e,t){return(t||document).getElementsByTagName(e)}function $c(e,t){return(t||document).getElementsByClassName(e)}function $each(e,t){for(var a,n=0;a=e[n++];)t(a)}function $html(e,t){var a=e.cloneNode(!1);return a.innerHTML=t,e.parentNode.replaceChild(a,e),a}function $attr(e,t){for(var a in t)"text"!=a?"value"!=a?"html"!=a?e.setAttribute(a,t[a]):e.innerHTML=t[a]:e.value=t[a]:e.textContent=t[a];return e}function $event(e,t){for(var a in t)t.hasOwnProperty(a)&&(e.addEventListener?e.addEventListener(a,t[a],!1):e.attachEvent(a,t[a]))}function $before(e,t){for(var a=0,n=t.length;n>a;a++)t[a]&&e.parentNode.insertBefore(t[a],e)}function $after(e,t){for(var a=t.length;a--;)t[a]&&e.parentNode.insertBefore(t[a],e.nextSibling)}function $new(e,t,a){var n=document.createElement(e);return t&&$attr(n,t),a&&$event(n,a),n}function $disp(e){e.style.display="none"==e.style.display?"":"none"}function $del(e){e&&e.parentNode&&e.parentNode.removeChild(e)}function $offset(e,t){for(var a=0;e;)a+=e[t],e=e.offsetParent;return a}function $close(e){if(e){var t=e.clientHeight-18;e.style.height=t+"px";var a=8,n=setInterval(function(){if(!e||a--<0)return clearInterval(n),void $del(e);var o=e.style;o.opacity=a/10,o.paddingTop=parseInt(o.paddingTop)-1+"px",o.paddingBottom=parseInt(o.paddingBottom)-1+"px";var i=parseInt(o.height)-t/10;o.height=(0>i?0:i)+"px"},35)}}function $show(e){var t=0,a=setInterval(function(){if(!e||t++>8)return void clearInterval(a);var n=e.style;n.opacity=t/10,n.paddingTop=parseInt(n.paddingTop)+1+"px",n.paddingBottom=parseInt(n.paddingBottom)+1+"px"},35)}function _disabled_insert(e){var t=document.forms.postform.shampoo;if(t){if(t.createTextRange&&t.caretPos){var a=t.caretPos;a.txt=" "==a.txt.charAt(a.txt.length-1)?e+" ":e}else if(t.setSelectionRange){var n=t.selectionStart,o=t.selectionEnd;t.value=t.value.substr(0,n)+e+t.value.substr(o),t.setSelectionRange(n+e.length,n+e.length)}else t.value+=e+" ";t.focus()}}function AJAX(e,t,a){var n;if(window.XMLHttpRequest)n=new XMLHttpRequest;else{if(!window.ActiveXObject)return!1;try{n=new ActiveXObject("Msxml2.XMLHTTP")}catch(o){try{n=new ActiveXObject("Microsoft.XMLHTTP")}catch(o){}}}n.onreadystatechange=function(){if(4==n.readyState)if(200==n.status){var e=n.responseText;e=e.split(/<form[^>]+posts[^>]+>/)[1].split("</form>")[0];for(var t=e.substring(0,e.lastIndexOf(e.match(/<br[^>]+left/))).split(/<br[^>]+left[^>]*>\s*<hr[^>]*>/),o=0,i=t.length;i>o;o++){var r=t[o].match(/<input[^>]+checkbox[^>]+>/i)[0].match(/(\d+)/)[0],s=t[o].split(/<table[^>]*>/);ajaxThrds[r]={keys:[],pcount:s.length};for(var l=0,d=s.length;d>l;l++){var e=s[l],c=e.match(/<input[^>]+checkbox[^>]+>/i)[0].match(/(\d+)/)[0];ajaxThrds[r].keys.push(c),ajaxPosts[c]=e.substring(!/<td/.test(e)&&/filesize[^>]*>/.test(e)?e.search(/filesize[^>]*>/)-13:e.indexOf("<label"),/<td/.test(e)?e.lastIndexOf("</td"):/omittedposts[^>]*>/.test(e)?e.lastIndexOf("</span")+7:e.lastIndexOf("</blockquote")+13),ajaxRefmap(ajaxPosts[c].substr(ajaxPosts[c].indexOf("<blockquote>")+12),c)}}a()}else a("HTTP "+n.status+" "+n.statusText)},n.open("GET","/"+e+"/res/"+t+".html",!0),n.setRequestHeader("Accept-Encoding","deflate, gzip, x-gzip"),n.send()}function getRefMap(e,t){refMap[t]||(refMap[t]=[]),(","+refMap[t].toString()+",").indexOf(","+e+",")<0&&refMap[t].push(e)}function ajaxRefmap(e,t){var a=e.match(/&gt; &gt; \d+/g);if(a)for(var n=0;rLen=a.length,n<rLen;n++)getRefMap(t,a[n].match(/\d+/g))}function showRefMap(e,t,a){if("object"==typeof refMap[t]&&e){var n="Ответы: "+refMap[t].toString().replace(/(\d+)/g,'<a href="#$1" onmouseover="showPostPreview(event)" onmouseout="delPostPreview(event)">&gt;&gt;$1</a>'),o=a?$id("ABU-refmap-"+t):null;o?$html(o,n):(o=$new("div",{"class":"ABU-refmap",id:"ABU-refmap-"+t,html:n}),$after($t("blockquote",e)[0],[o]))}}function addRefMap(e){$each($t("a",e),function(e){if(0==e.textContent.indexOf(">>")){var t=e.hash.match(/\d+/);if(postByNum[t]){for(;"BLOCKQUOTE"!=(e=e.parentNode).tagName;);getRefMap(e.parentNode.id.match(/\d+/),t)}}});for(var t in refMap)showRefMap(postByNum[t],t,Boolean(e))}function buildTablePost(e){return $new("table",{"class":"post",id:"post-"+e,html:"<tbody><tr> "+ajaxPosts[e]+" </tr></tbody>"})}function _disabled_updateThread(){var e=$id("ABU-getnewposts");e.innerHTML='[<span style="cursor:default">Обновить тред</span>]',$alert("Загрузка...","wait");var t=$c("thread")[0],a=t.id.match(/\d+/)[0],n=Posts.length+1;AJAX(board,a,function(o){if($close($id("ABU-alert-wait")),o)return void $alert(o);ajaxThrds[a].pcount-n==0&&$alert("Нет новых постов");for(var i=n,r=ajaxThrds[a].pcount;r>i;i++){var s=ajaxThrds[a].keys[i],l=buildTablePost(s);l.Num=s,t.appendChild(l),postByNum[s]=l,Posts.push(l),eventPostPreview(l),addRefMap(l)}setTimeout(function(){e.innerHTML='[<a href="#" onclick="updateThread(); return false;">Обновить тред</a>]'},2e3)},!0)}function _disabled_expandThread(e,t){$alert("Загрузка...","wait");var a=$id("thread-"+e);AJAX(board,e,function(n){if($close($id("ABU-alert-wait")),n)return void $alert(n);for(var o=postByNum[e],i=$t("blockquote",o)[0];i.nextSibling;)$del(i.nextSibling);for(;o.nextSibling;)$del(o.nextSibling);var r=ajaxThrds[e].keys.length;t=t?r-t:1,t>1&&o.appendChild($new("span",{"class":"omittedposts",text:" Пропущено "+parseInt(t-1)+' ответов. Нажмите "ответ", чтобы увидеть тред целиком.'}));for(var s=t;r>s;s++){var l=ajaxThrds[e].keys[s],d=buildTablePost(l);d.Num=l,a.appendChild(d),postByNum[l]=d,Posts.push(d),eventPostPreview(d),addRefMap(d)}})}function expandPost(e){$alert("Загрузка...","wait");var t=e.pathname.match(/\/(\d+)\./)[1],a=e.hash.match(/\d+/)||t;AJAX(board,t,function(t){$close($id("ABU-alert-wait")),t||(e.parentNode.parentNode.innerHTML=ajaxPosts[a].substr(ajaxPosts[a].indexOf('class="postMessage">')+20,ajaxPosts[a].indexOf("</blockquote>")))})}function areYouShure(e){return confirm("Вы уверены в своих действиях?")&&(document.location=e.href),!1}function writeBan(e){var t=prompt("Напишите причину бана, пожалуйста:");return t&&(document.location=e.href+"&comment="+encodeURIComponent(t)),!1}function writeBoard(e){var t=prompt("Укажите доску, куда перенести тред:");return t&&(document.location=e.href+"&new_board="+encodeURIComponent(t)),!1}function addDate(e){var t=new Date;return t.setTime(t.getTime()+24*e*60*60*1e3),t.getFullYear().toString()+"%2F"+(t.getMonth()+1).toString()+"%2F"+t.getDate().toString()}function getMultiplePostsForBanset(){for(var e="",t=document.forms["posts-form"],a=0;a<t.elements.length;++a)t.elements[a].checked&&(e+="&mod_id_"+t.elements[a].value+"="+board+"_"+t.elements[a].value);return e}function removeAdminMenu(e){for(var t=e.relatedTarget;;){if("ABU-select"==t.id)break;if(t=t.parentNode,!t)break}t||$del($id("ABU-select"))}function addAdminMenu(e){var t=$(e).closest(".post").data("num"),a=getMultiplePostsForBanset();""==a&&(a="&mod_id_single="+board+"_"+t),document.body.appendChild($new("div",{"class":"reply",id:"ABU-select",style:"left:"+($offset(e,"offsetLeft").toString()-18)+"px; top:"+($offset(e,"offsetTop")+e.offsetHeight-1).toString()+"px",html:'<a href="/makaba/makaba.fcgi?task=moder&action=posts_del'+a+'" onclick="return areYouShure(this)">Удалить</a><a href="/makaba/makaba.fcgi?task=moder&action=posts_ban'+a+'" onclick="return writeBan(this)">Забанить</a><a href="/makaba/makaba.fcgi?task=moder&action=posts_ban'+a+"&expires="+addDate(2)+'" onclick="return writeBan(this)">Забанить на два дня</a><a href="/makaba/makaba.fcgi?task=moder&action=posts_ban'+a+"&expires="+addDate(7)+'" onclick="return writeBan(this)">Забанить на неделю</a><a href="/makaba/makaba.fcgi?task=moder&action=posts_ban'+a+"&expires="+addDate(30)+'" onclick="return writeBan(this)">Забанить на месяц</a><a href="/makaba/makaba.fcgi?task=moder&action=posts_del_ban'+a+'" onclick="return writeBan(this)">Удалить и забанить</a><a href="/makaba/makaba.fcgi?task=moder&action=posts_del_ban'+a+"&expires="+addDate(2)+'" onclick="return writeBan(this)">Удалить и забанить на два дня</a><a href="/makaba/makaba.fcgi?task=moder&action=posts_del_ban'+a+"&expires="+addDate(7)+'" onclick="return writeBan(this)">Удалить и забанить на неделю</a><a href="/makaba/makaba.fcgi?task=moder&action=posts_del_all'+a+'" onclick="return areYouShure(this)">Удалить всё</a><a href="/makaba/makaba.fcgi?task=moder&action=posts_del_all_ban'+a+'" onclick="return writeBan(this)">Удалить всё и забанить</a><a href="/makaba/makaba.fcgi?task=moder&action=posts_del_all_ban'+a+"&expires="+addDate(2)+'" onclick="return writeBan(this)">Удалить всё и забанить на два дня</a><a href="/makaba/makaba.fcgi?task=moder&action=posts_del_all_in_thread'+a+'" onclick="return areYouShure(this)">Удалить всё в треде</a><a href="/makaba/makaba.fcgi?task=moder&action=posts_del_file'+a+'" onclick="return areYouShure(this)">Удалить файл</a><a href="/makaba/makaba.fcgi?task=moder&action=posts_mark'+a+'&mark_type=2" onclick="return areYouShure(this)">Выдать предупреждение</a><a href="/makaba/makaba.fcgi?task=moder&action=posts_mark'+a+'&mark_type=1" onclick="return areYouShure(this)">Метка о бане</a><a href="/makaba/makaba.fcgi?task=moder&action=thread_stick'+a+'" onclick="return areYouShure(this)">Прикрепить тред</a><a href="/makaba/makaba.fcgi?task=moder&action=thread_unstick'+a+'" onclick="return areYouShure(this)">Открепить тред</a><a href="/makaba/makaba.fcgi?task=moder&action=thread_open'+a+'" onclick="return areYouShure(this)">Открыть тред</a><a href="/makaba/makaba.fcgi?task=moder&action=thread_close'+a+'" onclick="return areYouShure(this)">Закрыть тред</a><a href="/makaba/makaba.fcgi?task=moder&action=thread_move'+a+'" onclick="return writeBoard(this)">Перенести тред</a><a href="/makaba/makaba.fcgi?task=moder&action=post_edit_show'+a+'" onclick="return areYouShure(this)">Редактировать пост</a><a href="/makaba/makaba.fcgi?task=moder&action=add_mod_tag'+a+'" onclick="return areYouShure(this)">Добавить мод тег</a><a href="/makaba/makaba.fcgi?task=moder&action=posts_del_everywhere'+a+'" class="mod-action-massban" onclick="return areYouShure(this)">Удалить всё на борде</a><a href="/makaba/makaba.fcgi?task=moder&action=posts_del_everywhere_ban'+a+'" class="mod-action-massban" onclick="return writeBan(this)">Удалить все и забанить на борде</a>'},{mouseout:removeAdminMenu}))}function removePostOptionMenu(e){for(var t=e.relatedTarget;;){if("ABU-select"==t.id)break;if(t=t.parentNode,!t)break}t||$del($id("ABU-select"))}function addPostOptionMenu(e){var t=e.parentNode.parentNode.parentNode.id.match(/\d+/),a=getMultiplePostsForBanset();""==a&&(a="&mod_id_single="+board+"_"+t),document.body.appendChild($new("div",{"class":"reply",id:"ABU-select",style:"left:"+($offset(e,"offsetLeft").toString()-18)+"px; top:"+($offset(e,"offsetTop")+e.offsetHeight-1).toString()+"px",html:'<a href="" class="postbtn-reply-href">Ответить</a><a href="" onclick="return areYouShure(this)">Пожаловаться</a><a href="" onclick="return areYouShure(this)">Скрыть</a><a href="" onclick="return areYouShure(this)">Найти картинку в google</a>'},{mouseout:removePostOptionMenu}))}function $alert(e,t){var a,n="ABU-alert";t&&(n+="-"+t,a=$id(n)),a||(a=$new("div",{"class":"reply",id:n,style:"float:right; clear:both; opacity:0; width:auto; min-width:0; padding:0 10px 0 10px; margin:1px; overflow:hidden; white-space:pre-wrap; outline:0; border:1px solid grey"}),"wait"==t&&a.appendChild($new("span",{"class":"ABU-icn-wait"})),a.appendChild($new("div",{style:"display:inline-block; margin-top:4px"})),$show($id("ABU-alertbox").appendChild(a))),$t("div",a)[0].innerHTML=e,"wait"!=t&&setTimeout(function(){$close(a)},6e3)}function reverseCaptcha(e){if(!(e.which<1040||e.which>1279)){e.preventDefault();var t="f,dult;pbqrkvyjghcnea[wxio]sm'.z",a=e.which-1072;if(!(0>a||a>=t.length)){var n=t[a];"a">n||n>"z"||(e.target.value=e.target.value+n)}}}function GetCaptcha(e,t){var a="",n=get_cookie("usercode"),o="/makaba/captcha.fcgi";if(""!=n&&t&&(o+="?usercode="+n),$.ajax({url:o,dataType:"html",timeout:2e4,async:!1,success:function(e){a=e}}),-1!=a.indexOf("VIPFAIL"))a='<span class="captcha-notif">Ваш пасс-код не действителен, пожалуйста, перелогиньтесь..</span>';else if(-1!=a.indexOf("VIP"))a='<span class="captcha-notif">Вам не нужно вводить капчу, у вас введен пасс-код.</span>';else if(-1!=a.indexOf("CHECK")){var i=a.substr(a.lastIndexOf("\n")+1);a=""==e?'<input type="hidden" name="captcha" id="captcha-captcha-div" value="'+i+'"><img src="'+window.location.protocol+"//captcha.yandex.net/image?key="+i+"\" onclick=\"GetCaptcha('captcha-div', ":'<input type="hidden" name="captcha" id="captcha-'+e+'" value="'+i+'"><img src="'+window.location.protocol+"//captcha.yandex.net/image?key="+i+'" onclick="GetCaptcha(\''+e+"', ",a+=t?'true);"><br><input type="text" autocomplete="off" name="captcha_value_id_06">':'false);">'}else a="<p>"+a+"</p>";""==e?document.write(a):$id(e).innerHTML=a}function UnbanHide(e){$(e).parent().hide()}function UnbanShow(){$("#unban-div").css("display",""),GetCaptcha("unban-captcha-div",!1)}function UnbanSubmit(){var e=new Object;e.task="unban",e.captcha=$("#captcha-unban-captcha-div").val(),e.captcha_value=$("#unban-captcha-input").val(),e.ban_num=$("#unban-ban-num-input").val(),e.request=$("#unban-comment-input").val();var t="--AaB03x";for(var a in e)e.hasOwnProperty(a)&&(t+='\r\nContent-Disposition: form-data; name="'+a+'"\r\n\r\n'+e[a]+"\r\n--AaB03x");t+="--\r\n",$.ajax({type:"POST",url:"/makaba/makaba.fcgi",data:t,dataType:"html",async:!1,contentType:"multipart/form-data; charset=UTF-8; boundary=AaB03x",success:function(e,t){try{var a=$.parseJSON(e);null==a.Error?alert(a.Result):alert(a.Error)}catch(n){}},error:function(e,t,a){alert("Ошибка соединения!")}}),$("#unban-div").hide(),$("#unban-form")[0].reset()}function UnbanHide(e){$(e).parent().hide()}function UnbanShow(){$("#unban-div").css("display",""),GetCaptcha("unban-captcha-div",!1)}function UnbanSubmit(){var e={};e.task="unban",e.captcha=$("#captcha-unban-captcha-div").val(),e.captcha_value=$("#unban-captcha-input").val(),e.ban_num=$("#unban-ban-num-input").val(),e.request=$("#unban-comment-input").val();var t="--AaB03x";for(var a in e)e.hasOwnProperty(a)&&(t+='\r\nContent-Disposition: form-data; name="'+a+'"\r\n\r\n'+e[a]+"\r\n--AaB03x");t+="--\r\n",$.ajax({type:"POST",url:"/makaba/makaba.fcgi",data:t,dataType:"html",async:!1,contentType:"multipart/form-data; charset=UTF-8; boundary=AaB03x",success:function(e,t){try{var a=$.parseJSON(e);null==a.Error?alert(a.Result):alert(a.Error)}catch(n){}},error:function(e,t,a){alert("Ошибка соединения!")}}),$("#unban-div").hide(),$("#unban-form")[0].reset()}function ToggleNormalReply(e){$id(e).hasChildNodes()?(pArea=$id("postform")[0],pArea.append(pForm),pForm=pArea.firstChild,isMain?$id(e+"Label").innerHTML="Создать тред":$id(e+"Label").innerHTML="Ответить в тред"):(pArea=$c(e)[0],pArea.append(pForm),pForm=pArea.firstChild,dForm&&$attr(pArea.firstChild,{target:"ABU_submitframe"}),$id(e+"Label").innerHTML="Закрыть форму постинга",$id("adcopy-response")&&($id("adcopy-response").onkeypress=reverseCaptcha))}function addQuickReply(e){if(e!=QuickReplyLastPostNum){var t=postByNum[e],a=t.parentNode.id.match(/\d+/),n=GetSelectedText();pArea=t.parentNode,pArea.insertBefore(pForm,t.nextSibling),pForm=t.nextSibling,$attr(pForm,{target:"ABU_submitframe"}),$n("thread").value=a,n?insert(">>"+e+"\n>"+n+"\n"):insert(">>"+e+"\n"),addDate(1),QuickReplyLastPostNum=e,isMain?$id("TopNormalReplyLabel").innerHTML=$id("BottomNormalReplyLabel").innerHTML="Создать тред":$id("TopNormalReplyLabel").innerHTML=$id("BottomNormalReplyLabel").innerHTML="Ответить в тред"}else pArea=$id("postform")[0],pArea.append(pForm),pForm=pArea.firstChild,QuickReplyLastPostNum=null}function doPost(){postform=$("#postform");var e={};postslength1=$(".thread > div").length+1;for(var t=["task","board","thread","code","email","captcha","icon","subject","name"],a=t.length,n=0;a>n;n++){var o=t[n];postform.find('input[name="'+o+'"]').val()&&(e[o]=postform.find('input[name="'+o+'"]').val())}if(postform.find('input[name="captcha_value_id_06"]').val()&&(e.captcha_value_id_06=postform.find('input[name="captcha_value_id_06"]').val()),get_cookie("usercode")&&(e.usercode=get_cookie("usercode")),""!==postform.find('input[name="image1"]').val()){var i=new FormData;void 0!==$("#image1")[0]&&void 0!==$("#image1")[0].files&&void 0!==$("#image1")[0].files[0]&&i.append("image",$("#image1")[0].files[0]),i.append("id","123"),i.append("type","one"),i.append("img",$("#image1")[0].files[0]),e.image1=new FormData,e.image1.type="jpg"}postform.find('textarea[name="comment"]').val()&&(e.comment=postform.find('textarea[name="comment"]').val());var r="--AaB03x";for(var s in e)e.hasOwnProperty(s)&&(r+="image1"==s?'\r\nContent-Disposition: form-data; name="image1"; filename="hueta"\r\n\r\n'+$("#image1")[0].files[0]+"\r\n--AaB03x":'\r\nContent-Disposition: form-data; name="'+s+'"\r\n\r\n'+e[s]+"\r\n--AaB03x");return r+="--\r\n",console.debug(r),$.ajax({type:"POST",url:"/makaba/makaba.fcgi",data:r,dataType:"html",async:!1,contentType:"multipart/form-data; charset=UTF-8; boundary=AaB03x",success:function(e,t){try{var a=$.parseJSON(e);if(null==a.Error){postform.find('input[name="board"]').val(),postform.find('input[name="thread"]').val();$alert("Сообщение успешно добавлено. Обновляем!"),postform.find("#shampoo").val(""),updatePosts(null,a.Num)}else $alert(a.Error)}catch(n){}},error:function(e,t,a){$alert("Ошибка соединения!")}}),!1}function iframeLoad(e){$close($id("ABU-alert-wait"));try{if(frm=e.target.contentDocument,!frm||!frm.body||!frm.body.innerHTML)return}catch(e){return void $alert("Iframe error:\n"+e)}var t,a=JSON.parse(frm.body.innerHTML.replace(/(<([^>]+)>)/gi,""));if(null!=a.Error&&(t=a.Error),t)$alert("Ошибка:\n"+t),GetCaptcha("captcha-div",!0);else{$id("subject").value="",$id("shampoo").value="",$id("embed").value="";var n=$id("image");$html(n.parentNode,n.parentNode.innerHTML),isMain?QuickReplyLastPostNum?(addQuickReply(QuickReplyLastPostNum),$alert("Быстрое сообщение отправлено"),expandThread($n("thread").value,5),$n("thread").value="0",GetCaptcha("captcha-div",!0)):"Redirect"==a.Status&&(window.location="/"+board+"/res/"+a.Target+".html"):(QuickReplyLastPostNum&&addQuickReply(QuickReplyLastPostNum),updateThread(),GetCaptcha("captcha-div",!0))}frm.location.replace("about:blank")}function delSubmitIframe(){var e;e=document.getElementById("ABU-submitframe"),e.parentNode.removeChild(e)}function addSubmitIframe(){window.opera?"DOMFrameContentLoaded":"load";$t("body")[0].appendChild($new("iframe",{name:"ABU_submitframe",id:"ABU-submitframe",src:"about:blank",style:"display:none; width:0px; height:0px; border:none"},{load:iframeLoad}))}function toggleMommy(){set_cookie("mommy",0==(get_cookie("mommy")||0)?1:0),scriptCSS()}function hotkeyMommy(e){e||(e=window.event),e.altKey&&78==e.keyCode&&toggleMommy()}function scriptCSS(){var e=[];""!=makabadmin&&e.push(".postbtn-adm,.admin-element {display:inline-block !important;}"),1==get_cookie("mommy")&&e.push('img[src*="thumb"], object[width="320"] {opacity:0.04 !important} img[src*="thumb"]:hover, object[width="320"]:hover {opacity:1 !important}'),$id("ABU-css")?$id("ABU-css").textContent=e.join(" "):$t("head")[0].appendChild($new("style",{id:"ABU-css",type:"text/css",text:e.join(" ")}))}function fastload(){makabadmin=get_cookie("makabadmin"),makabadmin?($(".mod-code-input").val(makabadmin),$("#mod-mark-checkbox").show()):makabadmin="",$id("usercode-input")&&$(".usercode-input,.qr-usercode-input").val(get_cookie("usercode")),pForm=$id("postform"),pArea=$id("postform")[0],dForm=$id("posts-form"),scriptCSS(),dForm&&(dForm.appendChild($new("div",{id:"ABU-alertbox"})),$id("adcopy-response")&&($id("adcopy-response").onkeypress=reverseCaptcha),document.onkeydown=hotkeyMommy)}function GetSelectedText(){var e=window.getSelection?window.getSelection():document.getSelection?document.getSelection():document.selection.createRange().text;return e&&""!=e?e:""}function ToggleSage(){"sage"==$id("e-mail").value?($id("e-mail").value="",$id("sagecheckbox").checked=!1):($id("e-mail").value="sage",$id("sagecheckbox").checked=!0)}function LakeNavRedirect(e){0!=$id(e).selectedIndex&&(window.location.href="/.."+$id(e).value)}function _disables_edToolbar(e){document.write('<span class="m-bold"><img class="markup" src="/icons/markup_buttons/photon/bold.png" title="Жирный" onClick="doAddTags(\'[b]\',\'[/b]\',\''+e+"')\"></span>"),document.write('<span class="m-italic"><img class="markup" src="/icons/markup_buttons/photon/italic.png" title="Наклонный" onClick="doAddTags(\'[i]\',\'[/i]\',\''+e+"')\"></span>"),document.write('<span class="m-quote"><img class="markup" src="/icons/markup_buttons/photon/quote1.png" title="Цитирование" onClick="doAddTags(\'>\',\'\',\''+e+"')\"></span>"),document.write('<span class="m-underline"><img class="markup" src="/icons/markup_buttons/photon/underline.png" title="Нижнее подчёркивание" onClick="doAddTags(\'[u]\',\'[/u]\',\''+e+"')\"></span>"),document.write('<span class="m-overline"><img class="markup" src="/icons/markup_buttons/photon/overline.png" title="Верхнее подчёркивание" onClick="doAddTags(\'[o]\',\'[/o]\',\''+e+"')\"></span>"),document.write('<span class="m-spoiler"><img class="markup" src="/icons/markup_buttons/photon/spoiler.png" title="Спойлер" onClick="doAddTags(\'[spoiler]\',\'[/spoiler]\',\''+e+"')\"></span>"),document.write('<span class="m-strike"><img class="markup" src="/icons/markup_buttons/photon/strike.png" title="Зачёркнутый" onClick="doAddTags(\'[s]\',\'[/s]\',\''+e+"')\"></span>"),document.write('<span class="m-sup"><img class="markup" src="/icons/markup_buttons/photon/sup.png" title="Сдвиг текста вверх" onClick="doAddTags(\'[sup]\',\'[/sup]\',\''+e+"')\"></span>"),document.write('<span class="m-sub"><img class="markup" src="/icons/markup_buttons/photon/sub.png" title="Сдвиг текста вниз" onClick="doAddTags(\'[sub]\',\'[/sub]\',\''+e+"')\"></span>"),document.write("<br>")}function edToolbar(e){var t="";return t+='<span class="m-bold"><img class="markup" src="/icons/markup_buttons/photon/bold.png" title="Жирный" onClick="doAddTags(\'[b]\',\'[/b]\',\''+e+"')\"></span>",t+='<span class="m-italic"><img class="markup" src="/icons/markup_buttons/photon/italic.png" title="Наклонный" onClick="doAddTags(\'[i]\',\'[/i]\',\''+e+"')\"></span>",t+='<span class="m-quote"><img class="markup" src="/icons/markup_buttons/photon/quote1.png" title="Цитирование" onClick="doAddTags(\'>\',\'\',\''+e+"')\"></span>",t+='<span class="m-underline"><img class="markup" src="/icons/markup_buttons/photon/underline.png" title="Нижнее подчёркивание" onClick="doAddTags(\'[u]\',\'[/u]\',\''+e+"')\"></span>",t+='<span class="m-overline"><img class="markup" src="/icons/markup_buttons/photon/overline.png" title="Верхнее подчёркивание" onClick="doAddTags(\'[o]\',\'[/o]\',\''+e+"')\"></span>",t+='<span class="m-spoiler"><img class="markup" src="/icons/markup_buttons/photon/spoiler.png" title="Спойлер" onClick="doAddTags(\'[spoiler]\',\'[/spoiler]\',\''+e+"')\"></span>",t+='<span class="m-strike"><img class="markup" src="/icons/markup_buttons/photon/strike.png" title="Зачёркнутый" onClick="doAddTags(\'[s]\',\'[/s]\',\''+e+"')\"></span>",t+='<span class="m-sup"><img class="markup" src="/icons/markup_buttons/photon/sup.png" title="Сдвиг текста вверх" onClick="doAddTags(\'[sup]\',\'[/sup]\',\''+e+"')\"></span>",t+='<span class="m-sub"><img class="markup" src="/icons/markup_buttons/photon/sub.png" title="Сдвиг текста вниз" onClick="doAddTags(\'[sub]\',\'[/sub]\',\''+e+"')\"></span>",t+="<br>"}function doAddTags(e,t,a){if(ToolbarTextarea=$id(a),document.selection){var n=document.selection.createRange();n.text=e+n.text+t}else{var o=ToolbarTextarea.value.length,i=ToolbarTextarea.selectionStart,r=ToolbarTextarea.selectionEnd,s=ToolbarTextarea.scrollTop,l=ToolbarTextarea.scrollLeft,n=ToolbarTextarea.value.substring(i,r),d=e+n+t;ToolbarTextarea.value=ToolbarTextarea.value.substring(0,i)+d+ToolbarTextarea.value.substring(r,o),ToolbarTextarea.scrollTop=s,ToolbarTextarea.scrollLeft=l,ToolbarTextarea.focus(),ToolbarTextarea.setSelectionRange(i+e.length,r+e.length)}$("#"+a).keyup()}function ShowLakeSettings(){for(var e=0;e<$id("LakeSettingsStyle").options.length;e++)if($id("LakeSettingsStyle").options[e].value==get_cookie("wakabastyle")){$id("LakeSettingsStyle").options[e].selected=!0;break}var t,a,n,o,i,r,s;t=localStorage.getItem("LakeSettingsHideBoardsList"),a=localStorage.getItem("LakeSettingsHideNonReqFields"),n=localStorage.getItem("LakeSettingsHideToolbar"),o=localStorage.getItem("LakeSettingsHideRules"),i=localStorage.getItem("LakeSettingsPostForm"),r=localStorage.getItem("LakeSettingsAutoUpdate"),s=localStorage.getItem("LakeSettingsAutoUpdateInterval"),"1"==t&&($id("LakeSettingsHideBoardsList").checked=!0),"1"==a&&($id("LakeSettingsHideNonReqFields").checked=!0),"1"==n&&($id("LakeSettingsHideToolbar").checked=!0),"1"==o&&($id("LakeSettingsHideRules").checked=!0),$id("LakeSettingsPostForm").selectedIndex=i,"1"==r&&($id("LakeSettingsAutoUpdate").checked=!0),$id("LakeSettingsAutoUpdateInterval").value=s;var l,d="ABU-SettingsBox";l||(l=$new("div",{"class":"reply",id:d,style:"float:right; clear:both; opacity:0; width:auto; min-width:0; padding:0 10px 0 10px; margin:1px; overflow:hidden; white-space:pre-wrap; outline:0; border:1px solid grey"}),l.appendChild($new("div",{style:"display:inline-block; margin-top:4px"})),$show($id("ABU-alertbox").appendChild(l))),$t("div",l)[0].appendChild($id("LakeSettings"))}function doLakeSettings(){var e,t,a,n,o,i,r;if(e=localStorage.getItem("LakeSettingsHideBoardsList"),t=localStorage.getItem("LakeSettingsHideNonReqFields"),a=localStorage.getItem("LakeSettingsHideToolbar"),n=localStorage.getItem("LakeSettingsHideRules"),o=localStorage.getItem("LakeSettingsPostForm"),i=localStorage.getItem("LakeSettingsAutoUpdate"),r=parseInt(localStorage.getItem("LakeSettingsAutoUpdateInterval")),null!=$id("usrFlds")){switch("1"==e?($id("boardNav").style.display="none",$id("boardNavBottom").style.display="none",$id("boardNavMobile").style.display=""):($id("boardNav").style.display="",$id("boardNavBottom").style.display="",$id("boardNavMobile").style.display="none"),"1"==t?$id("usrFlds").style.display="none":$id("usrFlds").style.display="","1"==a?$id("CommentToolbar").style.display="none":$id("CommentToolbar").style.display="","1"==n?$id("rules").style.display="none":$id("rules").style.display="",o){case"2":ToggleNormalReply("BottomNormalReply");break;case"0":ToggleNormalReply("TopNormalReply");break;case"1":}"1"==i&&(r>5&&600>r?threadIntervalID=setInterval(updateThread,1e3*r):(threadIntervalID=setInterval(updateThread,6e4),$alert("Недопустимый интервал!"))),isMain?$id("TopNormalReplyLabel").innerHTML=$id("BottomNormalReplyLabel").innerHTML="[Создать тред]":$id("TopNormalReplyLabel").innerHTML=$id("BottomNormalReplyLabel").innerHTML="[Ответить в тред]"}}function LakeSettingsSave(){$id("LakeSettingsHideBoardsList").checked?localStorage.setItem("LakeSettingsHideBoardsList","1"):localStorage.setItem("LakeSettingsHideBoardsList","0"),$id("LakeSettingsHideNonReqFields").checked?localStorage.setItem("LakeSettingsHideNonReqFields","1"):localStorage.setItem("LakeSettingsHideNonReqFields","0"),$id("LakeSettingsHideToolbar").checked?localStorage.setItem("LakeSettingsHideToolbar","1"):localStorage.setItem("LakeSettingsHideToolbar","0"),$id("LakeSettingsHideRules").checked?localStorage.setItem("LakeSettingsHideRules","1"):localStorage.setItem("LakeSettingsHideRules","0"),localStorage.setItem("LakeSettingsPostForm",$id("LakeSettingsPostForm").value),$id("LakeSettingsAutoUpdate").checked?localStorage.setItem("LakeSettingsAutoUpdate","1"):localStorage.setItem("LakeSettingsAutoUpdate","0"),localStorage.setItem("LakeSettingsAutoUpdateInterval",$id("LakeSettingsAutoUpdateInterval").value),set_cookie("wakabastyle",$id("LakeSettingsStyle").value,365),set_stylesheet(get_cookie("wakabastyle")),doLakeSettings(),$id("ShowLakeSettings").appendChild($id("ABU-SettingsBox").firstChild),$close($id("ABU-SettingsBox"))}function expand(e,t,a,n,o,i,r,s){var l=$(window);if(!Store.get("mobile.dont_expand_images",!0)||!(l.width()<768||l.height()<480)){if(!s&&!window.expand_all_img&&Store.get("other.fullscreen_expand",!0))return fullscreenExpand(e,t,a,n,o,i,r);var d=$("#exlink-"+e).closest(".images");d.length&&(d.hasClass("images-single")?(d.removeClass("images-single"),d.addClass("images-single-exp")):d.hasClass("images-single-exp")&&(d.addClass("images-single"),d.removeClass("images-single-exp"))),n>screen.width&&(o=(screen.width-80)*o/n,n=screen.width-80);var c,p,m;if(p=t.split("/").pop().split("."),m=p.length>1?p.pop():"","webm"==m&&n>i&&o>r)closeWebm=$new("a",{href:t,id:"close-webm-"+e,"class":"close-webm",html:"[Закрыть]",onclick:" return expand('"+e+"','"+t+"','"+a+"',"+i+","+r+","+n+","+o+", 1);"}),refElem=$id("webm-icon-"+e),refElem.parentNode.insertBefore(closeWebm,refElem.nextSibling),c='<video id="html5video" onplay="webmPlayStarted(this)" onvolumechange="webmVolumeChanged(this)" controls="" autoplay="" '+(Store.get("other.webm_vol",!1)?"":'muted="1"')+' loop="1" name="media"><source src="'+t+'" type="video/webm" width="'+n+'" height="'+o+'" class="video" ></video>';else{if("webm"==m){var u=document.getElementById("close-webm-"+e);u.parentNode.removeChild(u)}if(c='<a href="'+t+'" name="expandfunc"  onClick="return expand(\''+e+"','"+t+"','"+a+"',"+i+","+r+","+n+","+o+","+(s?0:1)+');"><img src="'+(s?a:t)+'" width="'+n+'" height="'+o+'" class="img '+(s?"preview":"fullsize")+("webm"==m?" webm-file":"")+'" /></a>',s&&Store.get("other.expand_autoscroll",!0)){var f,g=Post(e);f=g.isRendered()?g.el():$("#preview-"+parseInt(e));var h=$(document),b=f.offset().top,k=h.scrollTop();k>b&&h.scrollTop(b)}}return $id("exlink-"+e).innerHTML=c,!1}}function abortWebmDownload(){var e=$("#html5video");if(e.length){var t=e.get(0);t.pause(0),t.src="",t.load(),e.remove()}}function webmPlayStarted(e){var t=$(e).get(0);t.volume=Store.get("other.webm_vol",0)}function webmVolumeChanged(e){var t=$(e).get(0),a=t.volume;t.muted&&(a=0),Store.set("other.webm_vol",a)}function expandAllPics(){window.expand_all_img=!0;for(var e=document.getElementsByName("expandfunc"),t=0;t<e.length;t++)e[t].click();delete window.expand_all_img}function showVideo(e,t){$id(e).style.display="",$id(t).style.display="none"}function ctrlEnter(e,t){!e.ctrlKey||10!=e.keyCode&&13!=e.keyCode||t.submit()}function get_password(e){var t=get_cookie(e);if(!t){t="";for(var a="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789",n=0;8>n;n++){var o=Math.floor(Math.random()*a.length);t+=a.substring(o,o+1)}}return t}function load(e,t){var a=$id(e);if(a){var n;if(window.XMLHttpRequest)n=new XMLHttpRequest;else{if(!window.ActiveXObject)return!1;try{n=new ActiveXObject("Msxml2.XMLHTTP")}catch(o){try{n=new ActiveXObject("Microsoft.XMLHTTP")}catch(o){}}}n?(n.open("GET",t,!1),n.send(null),a.innerHTML=n.responseText):a.innerHTML="NotLoaded"}}function set_stylesheet_frame(e,t){var a=get_frame_by_name(t);set_stylesheet(e),a&&set_stylesheet(e,a)}function set_stylesheet(e,t){set_cookie("wakabastyle",e,365);for(var a,n,o=t?t.document.getElementsByTagName("link"):document.getElementsByTagName("link"),i=!1,r=0;r<o.length;r++){var a=o[r].getAttribute("rel"),n=o[r].getAttribute("title");-1!=a.indexOf("style")&&n&&(o[r].disabled=!0,e==n&&(o[r].disabled=!1,i=!0))}i||set_preferred_stylesheet(t?t:!1)}function set_preferred_stylesheet(e){for(var t,a,n=e?e.document.getElementsByTagName("link"):document.getElementsByTagName("link"),o=0;o<n.length;o++)t=n[o].getAttribute("rel"),
a=n[o].getAttribute("title"),-1!=t.indexOf("style")&&a&&(n[o].disabled=-1!=t.indexOf("alt"))}function get_active_stylesheet(){for(var e,t,a=document.getElementsByTagName("link"),n=0;n<a.length;n++)if(e=a[n].getAttribute("rel"),t=a[n].getAttribute("title"),-1!=e.indexOf("style")&&t&&!a[n].disabled)return t;return null}function get_preferred_stylesheet(){for(var e,t,a=document.getElementsByTagName("link"),n=0;n<a.length;n++)if(e=a[n].getAttribute("rel"),t=a[n].getAttribute("title"),-1!=e.indexOf("style")&&-1==e.indexOf("alt")&&t)return t;return null}function get_frame_by_name(e){var t=window.parent.frames;for(i=0;i<t.length;i++)if(e==t[i].name)return t[i];return!1}function set_inputs(e){var t=$id(e),a=t.gb2,n=get_cookie("gb2");if(a&&n)for(var o=0;o<a.length;o++)a[o].checked=a[o].value==n;$n("name").value=get_cookie("name"),$n("email").value=get_cookie("email"),"sage"==get_cookie("email")&&($id("sagecheckbox").checked=!0),null!=$id("anoniconsselectlist")&&($id("anoniconsselectlist").selectedIndex=get_cookie("anoniconchoise"))}function buttonOK(){$id("dynamicNamed").name=$id("opt"+select.selectedIndex).value}function set_delpass(e){try{$id(e).password.value=get_cookie("password")}catch(t){}}var postByNum=[],ajaxPosts=[],ajaxThrds={},refMap=[],Posts=[],opPosts=[],pView,dForm,pForm,pArea,makabadmin,QuickReplyLastPostNum,threadIntervalID=null,board=window.location.toString().split("/")[3],isIE=0;Array.prototype.indexOf||(Array.prototype.indexOf=function(e){var t=this.length>>>0,a=Number(arguments[1])||0;for(a=0>a?Math.ceil(a):Math.floor(a),0>a&&(a+=t);t>a;a++)if(a in this&&this[a]===e)return a;return-1});var ToolbarTextarea;