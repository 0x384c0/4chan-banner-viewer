function expand(e,t,o,i,n,r,l,a){var s=$(window);if(!Store.get("mobile.dont_expand_images",!0)||!(s.width()<768||s.height()<480)){if(!a&&!window.expand_all_img&&Store.get("other.fullscreen_expand",!0))return fullscreenExpand(e,t,o,i,n,r,l);var d=$("#exlink-"+e).closest(".images");d.length&&(d.hasClass("images-single")?(d.removeClass("images-single"),d.addClass("images-single-exp")):d.hasClass("images-single-exp")&&(d.addClass("images-single"),d.removeClass("images-single-exp"))),i>screen.width&&(n=(screen.width-80)*n/i,i=screen.width-80);var m,c,h;if(c=t.split("/").pop().split("."),h=c.length>1?c.pop():"","webm"==h&&i>r&&n>l)closeWebm=$new("a",{href:t,id:"close-webm-"+e,class:"close-webm",html:"[Закрыть]",onclick:" return expand('"+e+"','"+t+"','"+o+"',"+r+","+l+","+i+","+n+", 1);"}),refElem=$id("webm-icon-"+e),refElem.parentNode.insertBefore(closeWebm,refElem.nextSibling),m='<video id="html5video" onplay="webmPlayStarted(this)" onvolumechange="webmVolumeChanged(this)" controls="" autoplay="" '+(Store.get("other.webm_vol",!1)?"":'muted="1"')+' loop="1" name="media"><source src="'+t+'" type="video/webm" width="'+i+'" height="'+n+'" class="video" ></video>';else{if("webm"==h){var p=document.getElementById("close-webm-"+e);p.parentNode.removeChild(p)}if(m='<a href="'+t+'" name="expandfunc"  onClick="return expand(\''+e+"','"+t+"','"+o+"',"+r+","+l+","+i+","+n+","+(a?0:1)+');"><img src="'+(a?o:t)+'" width="'+i+'" height="'+n+'" class="img '+(a?"preview":"fullsize")+("webm"==h?" webm-file":"")+'" /></a>',a&&Store.get("other.expand_autoscroll",!0)){var w,g=Post(e);w=g.isRendered()?g.el():$("#preview-"+parseInt(e));var v=$(document),f=w.offset().top,u=v.scrollTop();u>f&&v.scrollTop(f)}}return $id("exlink-"+e).innerHTML=m,!1}}function abortWebmDownload(){var e=$("#html5video");if(e.length){var t=e.get(0);t.pause(0),t.src="",t.load(),e.remove()}}function webmPlayStarted(e){var t=$(e).get(0);t.volume=Store.get("other.webm_vol",0)}function webmVolumeChanged(e){var t=$(e).get(0),o=t.volume;t.muted&&(o=0),Store.set("other.webm_vol",o)}function load(e,t){var o=$id(e);if(o){var i;if(window.XMLHttpRequest)i=new XMLHttpRequest;else{if(!window.ActiveXObject)return!1;try{i=new ActiveXObject("Msxml2.XMLHTTP")}catch(e){try{i=new ActiveXObject("Microsoft.XMLHTTP")}catch(e){}}}i?(i.open("GET",t,!1),i.send(null),o.innerHTML=i.responseText):o.innerHTML="NotLoaded"}}var board=window.location.toString().split("/")[3];Array.prototype.indexOf||(Array.prototype.indexOf=function(e){var t=this.length>>>0,o=Number(arguments[1])||0;for(o=o<0?Math.ceil(o):Math.floor(o),o<0&&(o+=t);o<t;o++)if(o in this&&this[o]===e)return o;return-1});