function draggable(e,t){var i,n,r=!1,o=0,s=$(window);e.mousedown(function(e){1==e.which&&(t&&t.mousedown&&t.mousedown(e.clientX,e.clientY)===!1||(e.preventDefault(),r=!0,o=0,i=e.clientX,n=e.clientY))}),s.mousemove(function(t){var s,a,d,c;r&&(s=t.clientX-i,a=t.clientY-n,o+=Math.abs(s)+Math.abs(a),i=t.clientX,n=t.clientY,d=parseInt(e.css("top")),c=parseInt(e.css("left")),e.css({top:d+a+"px",left:c+s+"px"}))}),s.mouseup(function(e){r&&(r=!1,o<6&&t&&t.click&&t.click(i,n))})}!function(){window.config={},window.config.autoUpdate={},window.config.favorites={},window.thread={},window.threadstats={},window.config.loadCaptchaTimeout=3e4,window.config.updatePostsTimeout=3e4,window.config.autoUpdate.minInterval=10,window.config.autoUpdate.maxInterval=30,window.config.autoUpdate.stepInterval=5,window.config.autoUpdate.faviconDefault='<link id="favicon" rel="shortcut icon" href="/favicon.ico"/>',window.config.autoUpdate.faviconNewposts='<link id="favicon" rel="shortcut icon" href="/wakaba/templates/img/favicon_newposts.ico"/>',window.config.autoUpdate.faviconDeleted='<link id="favicon" rel="shortcut icon" href="/wakaba/templates/img/favicon_deleted.ico"/>',window.config.favorites.interval_min=15,window.config.favorites.interval_max=43200,window.config.favorites.interval_multiplier=2,window.config.favorites.interval_error=120,window.config.favorites.interval_del_recheck=600,window.config.favorites.interval_lock=300,window.config.title=document.title,window.config.twitter_autoexpand=4,window.threadstats.refresh=60,window.threadstats.retry=10,window.threadstats.request_timeout=3e4,window.threadstats.count=10,window.tz_offset=3}(),window.Store={memory:{},type:null,init:function(){this.html5_available()?(this.type="html5",this.html5_load()):this.cookie_available()&&(this.type="cookie",this.cookie_load())},get:function(e,t){var i=this.parse_path(e);if(!i)return t;for(var n=this.memory,r=i.length,o=0;o<r-1;o++){var s=i[o];if(!n.hasOwnProperty(s))return t;n=n[s]}var a=n[i[o]];return"undefined"==typeof a?t:a},set:function(e,t){if("undefined"==typeof t)return!1;this.type&&this[this.type+"_load"]();var i=this.parse_path(e);if(!i)return!1;for(var n=this.memory,r=i.length,o=0;o<r-1;o++){var s=i[o];if(n.hasOwnProperty(s)||(n[s]={}),n=n[s],"object"!=typeof n)return!1}return n[i[o]]=t,this.type&&this[this.type+"_save"](),!0},del:function(e){var t=this.parse_path(e);if(!t)return!1;this.type&&this[this.type+"_load"]();var i,n,r=this.memory,o=t.length;for(n=0;n<o-1;n++){if(i=t[n],!r.hasOwnProperty(i))return!1;r=r[i]}return r.hasOwnProperty(t[n])&&delete r[t[n]],this.cleanup(t),this.type&&this[this.type+"_save"](),!0},cleanup:function(e){var t,i=this.memory,n=[this.memory],r=e.length;for(t=0;t<r-2;t++){var o=e[t];i=i[o],n.push(i)}for(t=r-2;t>=0;t--){var s=n[t],a=e[t],d=!0;if($.each(s[a],function(){return d=!1,!1}),!d)return!0;delete s[a]}},reload:function(){this.type&&this[this.type+"_load"]()},export:function(){return JSON.stringify(this.memory)},import:function(e){try{return this.memory=JSON.parse(e),this.type&&this[this.type+"_save"](),!0}catch(e){return!1}},parse_path:function(e){var t=e.match(/[a-zA-Z0-9_\-\.]+/);return null!=t&&(!!t.hasOwnProperty("0")&&(t[0]==e&&e.split(".")))},html5_available:function(){if(!window.Storage)return!1;if(!window.localStorage)return!1;try{return localStorage.__storage_test="wU1vJ0p3prU1","wU1vJ0p3prU1"==localStorage.__storage_test&&(localStorage.removeItem("__storage_test"),!0)}catch(e){return!1}},html5_load:function(){localStorage.store&&(this.memory=JSON.parse(localStorage.store))},html5_save:function(){localStorage.store=JSON.stringify(this.memory)},cookie_available:function(){try{return $.cookie("__storage_test","wU1vJ0p3prU1"),"wU1vJ0p3prU1"==$.cookie("__storage_test")&&($.removeCookie("__storage_test"),!0)}catch(e){return!1}},cookie_load:function(){var e=$.cookie("store");e&&(this.memory=JSON.parse(e))},cookie_save:function(){var e=JSON.stringify(this.memory);$.cookie("store",e,1825)}},window.Media={processors:[],generators:{},unloaders:{},thumbnailers:{},add:function(e,t,i,n){var r=new RegExp(i,"i");this.processors.push([e,t,r,n])},addGenerator:function(e,t){this.generators[e]=t},addUnloader:function(e,t){this.unloaders[e]=t},addThumbnailer:function(e,t){this.thumbnailers[e]=t},parse:function(e){for(var t,i=this.processors.length,n=0;n<i;n++){var r=this.processors[n];if(!(e.indexOf(r[1])<0)&&(t=this.getValues(e,r)))break}return t},getValues:function(e,t){var i=t[0],n=t[2],r=t[3],o={type:i},s=n.exec(e);if(!s)return!1;for(var a in r)if(r.hasOwnProperty(a)){if(!s.hasOwnProperty(r[a]))return!1;o[a]=s[r[a]]}return o},getEmbedCode:function(e,t,i){this.generators[e]({id:t},i)},processLinks:function(e){e.each(function(){var e=$(this),t=e.text(),i=Media.parse(t);if(i){var n=e.closest(".post"),r=$('<span href="#" class="media-expand-button">[РАСКРЫТЬ]</span>'),o=$('<span href="#" class="media-hide-button">[ЗАКРЫТЬ]</span>'),s=$('<span class="media-expand-loading">[Загрузка...]</span>');if(Media.thumbnailers.hasOwnProperty(i.type)&&Store.get("old.media_thumbnails",!0)){var a=Store.get("old.media_thumbnails_on_hover",!0),d=$('<div class="media-thumbnail" '+(a?'style="display:none"':"")+">"+Media.thumbnailers[i.type](i)+"</div>"),c=$("#media-thumbnail");a?(e.hover(function(e){c.append(d).css({position:"absolute",display:"block","z-index":"999",top:e.pageY+"px",left:e.pageX+"px"}),d.show()}),e.mouseout(function(){d.hide(),c.hide()}),e.mousemove(function(e){c.css({top:e.pageY-10+"px",left:e.pageX+30+"px"})})):r.append(d)}e.after(r),r.click(function(){r.hide(),r.after(s);var t=n.data("expanded-media-count")||0;return t++,n.data("expanded-media-count",t),1==t&&window.kostyl_class&&n.addClass("expanded-media"),Media.getEmbedCode(i.type,i.id,function(t){if(s.remove(),!t)return r.show();var a=$("<br>"+t+"<br>");return e.after(a),e.after(o),o.click(function(){a.remove(),o.remove(),r.show(),Media.unloaders.hasOwnProperty(i.type)&&Media.unloaders[i.type](e);var t=n.data("expanded-media-count");return t--,n.data("expanded-media-count",t),0==t&&window.kostyl_class&&n.removeClass("expanded-media"),!1}),!1}),!1}),"twitter"==i.type&&window.config.twitter_autoexpand-- >0&&r.click()}})}},window.Favorites={timer:0,current:null,busy:!1,visible:!1,gevent_num:!1,gevent:!1,isFavorited:function(e){return!!Store.get("favorites."+e,!1)},remove:function(e){if(!this.isFavorited(e))throw new Error("Вызов Favorites.remove("+e+") для несуществующего треда");Store.del("favorites."+e),this.busy||this.reset(),this.render_remove(e),Gevent.emit("fav.remove",e)},add:function(e){if(this.isFavorited(e))throw new Error("Вызов Favorites.add("+e+") для существующего треда");var t=Post(e),i=t.getTitle(),n=t.last().num,r={board:window.thread.board,title:i,last_post:n,next_check:Math.floor(+new Date/1e3)+window.config.favorites.interval_min,last_interval:window.config.favorites.interval_min};Store.set("favorites."+e,r),this.render_add(e,r),Gevent.emit("fav.add",[e,r]),window.thread.id||this.reset()},reset:function(){this.resetCurrent(),this.current&&this.timerRestart(),this.busy=!1},timerStop:function(){this.timer&&(clearTimeout(this.timer),this.timer=null)},timerRestart:function(){this.timerStop();var e,t=Math.floor(+new Date/1e3),i=this.getCurrent().next_check-t,n=this;e=i<1?1:1e3*i,this.timer=setTimeout(function(){n.preExecuteCheck()},e)},getCurrent:function(){return Store.get("favorites."+this.current,!1)},resetCurrent:function(){this.current=null;var e=Store.get("favorites",{}),t=Store.get("favorites.deleted_behavior",2);for(var i in e)if(e.hasOwnProperty(i)&&i!=window.thread.id&&e[i].hasOwnProperty("next_check")&&!this.isLocked(i)&&(!this.current||e[this.current].next_check>e[i].next_check)){if(e[i].deleted&&0==t)continue;this.current=i}},preExecuteCheck:function(){var e=this;this.busy=!0,this.render_refreshing(this.current),Gevent.onceNtemp("fav.abortExec"+this.current,1e3,function(){e.setNextCheck(e.current,window.config.favorites.interval_lock),e.render_refreshing_done(e.current),e.reset()},function(){e.executeCheck()}),Gevent.emit("fav.preExecuteCheck",this.current)},executeCheck:function(){var e=this.getCurrent().next_check,t=this.current;if(Store.reload(),this.isLocked()||e!=this.getCurrent().next_check)return this.render_refreshing_done(t),this.reset();this.lock();var i=this.getCurrent(),n={thread:this.current,from_post:i.last_post+1,board:i.board},r=this;Post(1)._fetchPosts(n,function(e){return e.hasOwnProperty("error")?"server"==e.error&&e.errorCode==-404?r.deleted(r.current):r.setNextCheck(r.current,window.config.favorites.interval_error):e.data.length?(r.setNewPosts(e.data.length),r.setLastPost(e.data),r.setNextCheck(r.current,window.config.favorites.interval_min),Store.get("favorites.show_on_new",!0)&&r.show()):r.setNextCheck(r.current,i.last_interval*window.config.favorites.interval_multiplier),r.unlock(),r.render_refreshing_done(r.current),r.reset()})},setNextCheck:function(e,t){var i=Store.get("favorites."+e);t<window.config.favorites.interval_min&&(t=window.config.favorites.interval_min),t>window.config.favorites.interval_max&&(t=window.config.favorites.interval_max),i.next_check=Math.floor(+new Date/1e3)+t,i.last_interval=t,Store.set("favorites."+e+".next_check",i.next_check),Store.set("favorites."+e+".last_interval",i.last_interval)},forceRefresh:function(e){Store.set("favorites."+e+".next_check",0),Store.set("favorites."+e+".last_interval",window.config.favorites.interval_min),this.busy||this.reset()},deleted:function(e){var t=Store.get("favorites.deleted_behavior",2),i="favorites."+e+".deleted";return 1==t?this.remove(e):2==t&&Store.get(i,!1)?this.remove(e):(Store.set(i,!0),this.resetNewPosts(e),this.render_deleted(e),this.setNextCheck(e,window.config.favorites.interval_del_recheck),void Gevent.emit("fav.deleted",e))},setLastPost:function(e,t){t||(t=this.current);for(var i=0,n=e.length,r=0;r<n;r++)e[r].num>i&&(i=e[r].num);i&&Store.set("favorites."+t+".last_post",parseInt(i))},setLastSeenPost:function(e,t){return t?void Store.set("favorites."+e+".last_seen",t):Store.del("favorites."+e+".last_seen")},setNewPosts:function(e){var t=this.getCurrent(),i=t.new_posts||0;t.new_posts=i+e,Store.set("favorites."+this.current+".new_posts",t.new_posts),i||this.setLastSeenPost(this.current,t.last_post),this.render_newposts(this.current,t.new_posts),Gevent.emit("fav.newposts",[this.current,t.new_posts])},resetNewPosts:function(e){this.isFavorited(e)&&(Store.set("favorites."+e+".new_posts",0),this.busy||this.reset(),this.setLastSeenPost(this.current,0),this.render_reset_newposts(e),Gevent.emit("fav.reset_newposts",e))},lock:function(e){e||(e=this.current);var t=Math.floor(+new Date/1e3)+window.config.favorites.interval_lock;Store.set("favorites."+e+".lock",t)},unlock:function(e){e||(e=this.current),Store.del("favorites."+e+".lock")},isLocked:function(e){e||(e=this.current);var t=Math.floor(+new Date/1e3),i=Store.get("favorites."+e+".lock",0);return i>t},show:function(){Store.set("styling.qr-fav.visible",!0),this.render_show()},hide:function(){Store.del("styling.qr-fav.visible"),this.render_hide()},debug:function(){var e=Store.get("favorites",{});for(var t in e)console.log(t+":"+Math.round(e[t].next_check-+new Date/1e3)+"s")},render_get_html:function(e,t){var i='<div id="fav-row'+e+'" class="fav-row">';return i+='<span class="fav-row-remove" data-num="'+e+'"></span>',i+='<span class="fav-row-update" id="fav-row-update'+e+'" data-num="'+e+'"></span>',i+='<span class="fav-row-refreshing" id="fav-row-refreshing'+e+'" style="display: none"></span>',i+=t.new_posts?'<span class="fav-row-newposts" id="fav-row-newposts'+e+'">('+t.new_posts+")</span>":'<span class="fav-row-newposts" id="fav-row-newposts'+e+'"></span>',i+='<a href="/'+t.board+"/res/"+e+".html#"+(t.last_seen||t.last_post)+'" id="fav-row-href'+e+'" class="fav-row-href'+(t.new_posts?" fav-row-updated":"")+(t.deleted?" fav-row-deleted":"")+'">',i+='<span class="fav-row-board">/'+t.board+"/</span>",i+='<span class="fav-row-num">'+e+"</span>",i+='<span class="fav-row-dash"> - </span>',i+='<span class="fav-row-title">'+(t.title||"<i>Без названия</i>")+"</span>",i+="</a>",i+="</div>"},render_remove:function(e){$("#fav-row"+e).remove(),this.render_switch(e,!1)},render_add:function(e,t){var i=this.render_get_html(e,t);$("#qr-fav-body").append(i),this.render_switch(e,!0)},render_switch:function(e,t){var i=$("#fa-star"+e);t?(i.addClass("fa-star"),i.removeClass("fa-star-o"),$("#postbtn-favorite-bottom").html("Отписаться от треда")):(i.removeClass("fa-star"),i.addClass("fa-star-o"),$("#postbtn-favorite-bottom").html("Подписаться на тред"))},render_refreshing:function(e){$("#fav-row-refreshing"+e).show(),$("#fav-row-update"+e).hide()},render_refreshing_done:function(e){$("#fav-row-refreshing"+e).hide(),$("#fav-row-update"+e).show()},render_newposts:function(e,t){$("#fav-row-href"+e).addClass("fav-row-updated"),$("#fav-row-newposts"+e).html("("+t+")")},render_reset_newposts:function(e){$("#fav-row-href"+e).removeClass("fav-row-updated"),$("#fav-row-newposts"+e).html("")},render_deleted:function(e){$("#fav-row-href"+e).addClass("fav-row-deleted")},render_show:function(){this.visible=!0,$("#qr-fav").show()},render_hide:function(){this.visible=!1,$("#qr-fav").hide()},init:function(){var e=window.thread.id&&this.isFavorited(window.thread.id);e&&(this.resetNewPosts(window.thread.id),Gevent.on("fav.preExecuteCheck",function(e){e==window.thread.id&&Gevent.emit("fav.abortExec"+window.thread.id)}));var t=this;$(".thread").each(function(e){var i=$(this).attr("id").substr(7);Favorites.isFavorited(i)&&t.render_switch(i,!0)}),this.reset()},_send_fav:function(e){!Store.get("godmode.send_fav",!0)}},window.Settings={categories:[],settings:{},editors:{},visible:!1,_editor_onsave:null,reload:function(){var e=this,t=$("#settings-body");t.html(""),this.renderCategories(t,function(t,i){e.renderSettings(t,i)})},addCategory:function(e,t){this.categories.push([e,t]),this.settings[e]={}},addSetting:function(e,t,i){this.settings[e][t]=i},getSetting:function(e,t){return this.settings[e][t]},addEditor:function(e,t,i){this.editors[e]=[t,i]},renderCategories:function(e,t){for(var i=this,n=0;n<this.categories.length;n++)(function(n){var r=i.categories[n],o=$('<span class="settings-category-switch settings-category-expand">+</span>'),s=$('<span class="settings-category-switch settings-category-contract" style="display: none">-</span>'),a=$('<div class="settings-category-name">'+r[1]+"</div>"),d=$('<div class="settings-category" id="settings-category'+r[0]+'" style="display: none"></div>');a.prepend(s),a.prepend(o),e.append(a),e.append(d),a.click(function(){d.toggle(),s.toggle(),o.toggle()}),t(r[0],d)})(n)},renderSettings:function(e,t){for(var i in this.settings[e])if(this.settings[e].hasOwnProperty(i)){var n=this.settings[e][i],r=$('<div class="settings-setting-row"></div>'),o=$('<span class="settings-setting-label">'+n.label+"</span>");if(n.multi){var s=$('<select class="settings-setting-multibox mselect"></select>');s.data("path",i),s.data("category",e);for(var a=0;a<n.values.length;a++)s.append('<option value="'+n.values[a][0]+'">'+n.values[a][1]+"</option>");s.val(Store.get(i,n.default)),o.append(s),r.append(o),t.append(r)}else{var d=$('<input type="checkbox" class="settings-setting-checkbox"/>');d.data("path",i),d.data("category",e),d.prop("checked",!!Store.get(i,n.default)),o.prepend(d),r.append(o),t.append(r)}n.hasOwnProperty("edit")&&function(e,t){var i=t.edit,n=$('<span class="setting-edit-btn a-link-emulator" title="'+i.label+'"></span>');n.click(function(){if(!e.editors.hasOwnProperty(i.editor))return!1;e._editor_onsave=Settings.editors[i.editor][1],e._editor_show=Settings.editors[i.editor][0],e._editor_path=i.path,e._editor_default_val=i.default;var t=Store.get(i.path,i.default);return $("#settings-btn-save").click(),i.hasOwnProperty("importable")?($("#setting-editor-btn-export").show(),$("#setting-editor-btn-import").show()):($("#setting-editor-btn-export").hide(),$("#setting-editor-btn-import").hide()),i.hasOwnProperty("saveable")?$("#setting-editor-btn-save").show():$("#setting-editor-btn-save").hide(),$("#setting-editor-title").html(i.title),$("#setting-editor-body").html(""),$("#setting-editor-window").show(),e.editors[i.editor][0](t,i.path,i.default),!1}),r.append(n)}(this,n)}},toggle:function(){this.visible?this.hide():this.show()},show:function(){this.reload(),$("#settings-window").show(),this.visible=!0},hide:function(){$("#settings-window").hide(),this.visible=!1}},window.Gevent={last_id:1,listeners:{},expire_time:1e3,init:function(){if("undefined"!=typeof localStorage){if(!localStorage.gevent_last||!localStorage.gevents)return localStorage.gevents="[]",void(localStorage.gevent_last=1);this.last_id=localStorage.gevent_last,this._deleteExpired();var e=this;window.addEventListener("storage",function(t){"gevent_last"==t.key&&(t.newValue<=e.last_id||e._changed(localStorage.gevent_last,localStorage.gevents))},!1)}},_deleteExpired:function(){try{for(var e=JSON.parse(localStorage.gevents),t=e.length,i=Math.random()*(10*this.expire_time)+10*this.expire_time,n=0;n<e.length;n++){var r=e[n],o=r[1];+new Date-o>i&&(e.splice(n,1),n--)}t!=e.length&&(localStorage.gevents=JSON.stringify(e))}catch(e){}},on:function(e,t){return this.listeners.hasOwnProperty(e)||(this.listeners[e]=[]),this.listeners[e].push(t),t},off:function(e,t){if(!t)throw new Error("Gevent.off no callback passed");if(!this.listeners.hasOwnProperty(e))return!1;var i=this.listeners[e].indexOf(t);return!(i<0)&&(this.listeners[e].splice(i,1),!0)},once:function(e,t){var i=this,n=function(r){i.off(e,n),t(r)};return this.on(e,n),n},onceNtemp:function(e,t,i,n){var r,o=this,s=setTimeout(function(){o.off(e,r),n&&n()},t);return r=this.once(e,function(e){clearTimeout(s),i(e)})},emit:function(e,t){if("undefined"!=typeof localStorage){t||(t=""),this.last_id++;var i=JSON.parse(localStorage.gevents);i.push([this.last_id,+new Date,e,t]),localStorage.gevents=JSON.stringify(i),localStorage.gevent_last=this.last_id,this._watchExpire(this.last_id)}},_watchExpire:function(e){var t=this;setTimeout(function(){t._removeExpired(e)},this.expire_time)},_removeExpired:function(e){for(var t=JSON.parse(localStorage.gevents),i=t.length,n=0;n<t.length;n++){var r=t[n],o=r[0];o==e&&t.splice(n,1)}t.length!=i&&(localStorage.gevents=JSON.stringify(t))},_changed:function(e,t){if(e!=this.last_id){var i=JSON.parse(t);i.sort(function(e,t){return e.id-t.id});for(var n=0;n<i.length;n++){var r=i[n],o=r[0],s=r[1];o<=this.last_id||+new Date-s>this.expire_time||this._handleEvent.apply(this,r)}}},_handleEvent:function(e,t,i,n){if(this.last_id=e,this.listeners.hasOwnProperty(i)){for(var r=this.listeners[i],o=[],s=0;s<r.length;s++)o.push(r[s]);for(var a=0;a<o.length;a++)o[a](n)}}},function(){var e=!1,t=!1,i=[],n=[],r="";window.loadInitialConfig=function(t){window.thread.id=t.thread_num,window.thread.board=t.board,window.thread.hideTimeout=7,e=!0;for(var n=0;n<i.length;n++)o.apply(this,i[n]);i=[]},$(function(){$("body").append('<div id="bmark_debug" style="display: none">'+r+"</div>"),t=!0;for(var e=0;e<n.length;e++)o.apply(this,n[e]);n=[],r=""}),window.Stage=function(r,s,a,d){Store.get("debug_disable_stage."+s,!1)||(a==Stage.INSTANT?(r="[I]"+r,o(r,d)):a==Stage.CONFLOAD?(r="[C]"+r,e?o(r,d):i.push([r,d])):a==Stage.DOMREADY?(r="[D]"+r,t?o(r,d):n.push([r,d])):a==Stage.ASYNCH&&(r="[A]"+r,setTimeout(function(){o(r,d)},1)))};var o=function(e,t){var i=+new Date;try{t()}catch(t){return s('<span style="color:#FF0000">На шаге "'+e+'" произошла ошибка:<br><pre>'+t+"\n"+t.stack+"</pre></span>"),!1}var n=+new Date,r=n-i;s(r+"ms) "+e+"<br>")},s=function(e){t?$("#bmark_debug").append(e):r+=e};Stage.INSTANT=1,Stage.CONFLOAD=2,Stage.DOMREADY=3,Stage.ASYNCH=4}(),Stage("Система раскрытия на полный экран","screenexpand",Stage.DOMREADY,function(){var e,t,i=$('<div style="position: fixed;display: none;background-color: #555555;padding:8px;-webkit-box-sizing: content-box;-moz-box-sizing: content-box;box-sizing: content-box;" id="fullscreen-container"></div>'),n=$(window),r=!1,o=!1,s=1,a=0,d=0,c=!1,l=8;$("body").append(i),window.fullscreenExpand=function(a,d,u,v,p){if(abortWebmDownload(),r==a)return h(),!1;var w=n.width(),g=n.height();if(e=v,t=p,s=1,r=a,c=".webm"==d.substr(-5),o=!1,i.html(c?'<video id="html5video" onplay="webmPlayStarted(this)" onvolumechange="webmVolumeChanged(this)" name="media" loop="1" '+(Store.get("other.webm_vol",!1)?"":'muted="1"')+' controls="" autoplay="" height="100%" width="100%"><source class="video" height="100%" width="100%" type="video/webm" src="'+d+'"></source></video>':'<img src="'+d+'" width="100%" height="100%" />').css("top",(g-p)/2-l+"px").css("left",(w-v)/2-l+"px").width(v).height(p).show(),v>w||p>g){var _=Math.floor(w/v*10)/10,m=Math.floor(g/p*10)/10;_<.1&&(_=.1),m<.1&&(m=.1),f(_<m?_:m,!0)}return!1};var h=function(){abortWebmDownload(),r=!1,o=!1,i.hide(),c&&i.html("")},f=function(n,r){n<.1||n>5||(u(n,r),s=n,i.width(e*s).height(t*s))},u=function(r,o){var c,l,h=n.scrollTop(),f=n.scrollLeft(),u=i.offset();o?(c=e/2,l=t/2):(c=a-u.left+f,l=d-u.top+h);var v=u.top-h,p=u.left-f,w=r-s,g=w*l/s,_=w*c/s;i.css("left",p-_+"px").css("top",v-g+"px")};i.mouseover(function(){o=!0}),i.mouseout(function(){o=!1}),i.mousemove(function(e){a=e.clientX,d=e.clientY}),n.keyup(function(e){if(r){var t,i=e.keyCode||e.which;if(37==i||65==i||97==i||1092==i)t=-1;else{if(39!=i&&68!=i&&100!=i&&1074!=i)return 27==i?h():void 0;t=1}var n=$(".image-link"),o=n.index($("#exlink-"+r)),s=o+t;s<0&&(s=n.length-1),s>n.length-1&&(s=0);var a=n.eq(s);a.find("a").click()}}),n.click(function(e){r&&1==e.which&&($(e.target).closest(".img").length||"expandfunc"!=$(e.target).attr("name")&&($(e.target).closest("#fullscreen-container").length||h()))}),n.bind(/Firefox/i.test(navigator.userAgent)?"DOMMouseScroll":"mousewheel",function(e){if(r&&o){e.preventDefault();var t=window.event||e;t=t.originalEvent?t.originalEvent:t;var i=t.detail?t.detail*-40:t.wheelDelta;f(i>0?s+.1:s-.1)}}),draggable(i,{click:function(){h()},mousedown:function(e,t){if(c){var n=parseInt(i.css("top")),r=i.height();return!(n+r-t<35)&&void 0}}})});